# JavaScript è®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼

## å‰è¨€

> åœ¨è½¯ä½“å·¥ç¨‹ä¸­ï¼Œè®¾è®¡æ¨¡å¼ï¼ˆdesign patternï¼‰æ˜¯å¯¹è½¯ä½“è®¾è®¡ä¸­æ™®éå­˜åœ¨ï¼ˆåå¤å‡ºç°ï¼‰çš„å„ç§é—®é¢˜ï¼Œæ‰€æå‡ºçš„è§£å†³æ–¹æ¡ˆã€‚
>
> è®¾è®¡æ¨¡å¼å¹¶ä¸ç›´æ¥ç”¨æ¥å®Œæˆç¨‹å¼ç çš„ç¼–å†™ï¼Œè€Œæ˜¯æè¿°åœ¨å„ç§ä¸åŒæƒ…å†µä¸‹ï¼Œè¦æ€ä¹ˆè§£å†³é—®é¢˜çš„ä¸€ç§æ–¹æ¡ˆã€‚
>
> è®¾è®¡æ¨¡å¼èƒ½ä½¿ä¸ç¨³å®šè½¬ä¸ºç›¸å¯¹ç¨³å®šã€å…·ä½“è½¬ä¸ºç›¸å¯¹æŠ½è±¡ï¼Œé¿å…ä¼šå¼•èµ·éº»çƒ¦çš„ç´§è€¦åˆï¼Œä»¥å¢å¼ºè½¯ä½“è®¾è®¡é¢å¯¹å¹¶é€‚åº”å˜åŒ–çš„èƒ½åŠ›
>
> â€”â€”[ç»´åŸºç™¾ç§‘](<https://zh.wikipedia.org/wiki/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F_(%E8%AE%A1%E7%AE%97%E6%9C%BA)>)

è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘çš„æ€æƒ³ï¼Œæœ‰ç›Šäºé™ä½ä»£ç çš„è€¦åˆæ€§ï¼Œå¢å¼ºä»£ç çš„å¥å£®æ€§ã€‚å¾€å¾€åœ¨å¤§å‹é¡¹ç›®ä¸­ç”¨çš„æ¯”è¾ƒå¤šã€‚

ä»Šå¤©å°±æ¥ä»‹ç»ä¸€ç§å¯ä»¥æ›¿ä»£é€‰æ‹©è¿ç®—çš„è®¾è®¡æ¨¡å¼â€”â€”ç­–ç•¥æ¨¡å¼ã€‚

## ä»‹ç»

> ç­–ç•¥æ¨¡å¼ä½œä¸ºä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ŒæŒ‡å¯¹è±¡æœ‰æŸä¸ªè¡Œä¸ºï¼Œä½†æ˜¯åœ¨ä¸åŒçš„åœºæ™¯ä¸­ï¼Œè¯¥è¡Œä¸ºæœ‰ä¸åŒçš„å®ç°ç®—æ³•ã€‚æ¯”å¦‚æ¯ä¸ªäººéƒ½è¦â€œäº¤ä¸ªäººæ‰€å¾—ç¨â€ï¼Œä½†æ˜¯â€œåœ¨ç¾å›½äº¤ä¸ªäººæ‰€å¾—ç¨â€å’Œâ€œåœ¨ä¸­å›½äº¤ä¸ªäººæ‰€å¾—ç¨â€å°±æœ‰ä¸åŒçš„ç®—ç¨æ–¹æ³•ã€‚
>
> ç­–ç•¥æ¨¡å¼ï¼š
>
> - å®šä¹‰äº†ä¸€æ—ç®—æ³•ï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰ï¼›
> - å°è£…äº†æ¯ä¸ªç®—æ³•ï¼›
> - è¿™æ—çš„ç®—æ³•å¯äº’æ¢ä»£æ›¿ï¼ˆinterchangeableï¼‰ã€‚
>
> â€”â€”[ç»´åŸºç™¾ç§‘](https://zh.wikipedia.org/wiki/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F)

![](./images/Strategy_Pattern_in_UML.png)

å¯ä»¥çœ‹å‡ºï¼Œä¸ºåº”å¯¹ä¸åŒåœºæ™¯æ‰€å¯¼è‡´ç®—æ³•ä¸åŒï¼ŒåŸºäºå·¥å‚æ¨¡å¼å°†å„ä¸ªç®—æ³•è¿›è¡Œå°è£…æˆç±»ï¼Œå†è¿›è¡Œä½¿ç”¨ï¼Œè¿™å°±æ˜¯ç­–ç•¥æ¨¡å¼ã€‚

## æ¡ˆä¾‹

æˆ‘ä»¬æ¥ä¸€ä¸ªä¾‹å­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬è¦åšæ•°æ®åˆæ³•æ€§éªŒè¯ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯æŒ‰ç…§ swith è¯­å¥æ¥åˆ¤æ–­ï¼ˆä¹Ÿå¯ä»¥æ˜¯ ifï¼Œelseifï¼Œelse çš„ç»“æ„ï¼‰ï¼Œä½†æ˜¯è¿™å°±å¸¦æ¥å‡ ä¸ªé—®é¢˜ï¼š

- å¦‚æœå¢åŠ éœ€æ±‚çš„è¯ï¼Œæˆ‘ä»¬è¿˜è¦å†æ¬¡ä¿®æ”¹è¿™æ®µä»£ç ä»¥å¢åŠ é€»è¾‘ã€‚
- åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ä¹Ÿä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```javascript
validator = {
  validate: function(value, type) {
    switch (type) {
      case "isNonEmpty ": {
        return true;
      }
      case "isNumber ": {
        return true;
        break;
      }
      case "isAlphaNum ": {
        return true;
      }
      default: {
        return true;
      }
    }
  }
};
//  æµ‹è¯•
alert(validator.validate("123", "isNonEmpty"));
```

é‚£å¦‚ä½•æ¥é¿å…ä¸Šè¿°ä»£ç ä¸­çš„é—®é¢˜å‘¢ï¼Œæ ¹æ®ç­–ç•¥æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç›¸åŒçš„å·¥ä½œä»£ç å•ç‹¬å°è£…æˆä¸åŒçš„ç±»ï¼Œç„¶åé€šè¿‡ç»Ÿä¸€çš„ç­–ç•¥å¤„ç†ç±»æ¥å¤„ç†ï¼ŒOKï¼Œæˆ‘ä»¬å…ˆæ¥å®šä¹‰ç­–ç•¥å¤„ç†ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
var validator = {
  // æ‰€æœ‰å¯ä»¥çš„éªŒè¯è§„åˆ™å¤„ç†ç±»å­˜æ”¾çš„åœ°æ–¹ï¼Œåé¢ä¼šå•ç‹¬å®šä¹‰
  types: {},
  // éªŒè¯ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯æ¶ˆæ¯
  messages: [],
  // å½“ç„¶éœ€è¦ä½¿ç”¨çš„éªŒè¯ç±»å‹
  config: {},
  // æš´éœ²çš„å…¬å¼€éªŒè¯æ–¹æ³•
  // ä¼ å…¥çš„å‚æ•°æ˜¯ key => valueå¯¹
  validate: function(data) {
    var i, msg, type, checker, result_ok;
    // æ¸…ç©ºæ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯
    this.messages = [];
    for (i in data) {
      if (data.hasOwnProperty(i)) {
        type = this.config[i]; // æ ¹æ®keyæŸ¥è¯¢æ˜¯å¦æœ‰å­˜åœ¨çš„éªŒè¯è§„åˆ™
        checker = this.types[type]; // è·å–éªŒè¯è§„åˆ™çš„éªŒè¯ç±»
        if (!type) {
          continue; // å¦‚æœéªŒè¯è§„åˆ™ä¸å­˜åœ¨ï¼Œåˆ™ä¸å¤„ç†
        }
        if (!checker) {
          // å¦‚æœéªŒè¯è§„åˆ™ç±»ä¸å­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸
          throw {
            name: "ValidationError",
            message: "No handler to validate type " + type
          };
        }
        result_ok = checker.validate(data[i]); // ä½¿ç”¨æŸ¥åˆ°åˆ°çš„å•ä¸ªéªŒè¯ç±»è¿›è¡ŒéªŒè¯
        if (!result_ok) {
          msg = "Invalid value for *" + i + "*, " + checker.instructions;
          this.messages.push(msg);
        }
      }
    }
    return this.hasErrors();
  },
  // helper
  hasErrors: function() {
    return this.messages.length !== 0;
  }
};
```

ç„¶åå‰©ä¸‹çš„å·¥ä½œï¼Œå°±æ˜¯å®šä¹‰ types é‡Œå­˜æ”¾çš„å„ç§éªŒè¯ç±»äº†ï¼Œæˆ‘ä»¬è¿™é‡Œåªä¸¾å‡ ä¸ªä¾‹å­ï¼š

```javascript
// éªŒè¯ç»™å®šçš„å€¼æ˜¯å¦ä¸ä¸ºç©º
validator.types.isNonEmpty = {
  validate: function(value) {
    return value !== "";
  },
  instructions: "ä¼ å…¥çš„å€¼ä¸èƒ½ä¸ºç©º"
};

// éªŒè¯ç»™å®šçš„å€¼æ˜¯å¦æ˜¯æ•°å­—
validator.types.isNumber = {
  validate: function(value) {
    return !isNaN(value);
  },
  instructions: "ä¼ å…¥çš„å€¼åªèƒ½æ˜¯åˆæ³•çš„æ•°å­—ï¼Œä¾‹å¦‚ï¼š1, 3.14 or 2010"
};

// éªŒè¯ç»™å®šçš„å€¼æ˜¯å¦åªæ˜¯å­—æ¯æˆ–æ•°å­—
validator.types.isAlphaNum = {
  validate: function(value) {
    return !/[^a-z0-9]/i.test(value);
  },
  instructions: "ä¼ å…¥çš„å€¼åªèƒ½ä¿æŠ¤å­—æ¯å’Œæ•°å­—ï¼Œä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦"
};
```

ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å®šä¹‰éœ€è¦éªŒè¯çš„æ•°æ®é›†åˆï¼Œç„¶åè¿˜éœ€è¦å®šä¹‰æ¯ç§æ•°æ®éœ€è¦éªŒè¯çš„è§„åˆ™ç±»å‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
var data = {
  first_name: "Tom",
  last_name: "Xu",
  age: "unknown",
  username: "TomXu"
};

validator.config = {
  first_name: "isNonEmpty",
  age: "isNumber",
  username: "isAlphaNum"
};
```

æœ€åï¼Œè·å–éªŒè¯ç»“æœçš„ä»£ç å°±ç®€å•äº†ï¼š

```javascript
validator.validate(data);

if (validator.hasErrors()) {
  console.log(validator.messages.join("\n"));
}
```

## æ€»ç»“

ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œæ‰€æœ‰çš„è¿™äº›ç®—æ³•éƒ½æ˜¯åšç›¸åŒçš„äº‹æƒ…ï¼Œåªæ˜¯å®ç°ä¸åŒï¼Œä»–å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è°ƒç”¨æ‰€æœ‰çš„æ–¹æ³•ï¼Œå‡å°‘äº†å„ç§ç®—æ³•ç±»ä¸ä½¿ç”¨ç®—æ³•ç±»ä¹‹é—´çš„è€¦åˆã€‚

ä»å¦å¤–ä¸€ä¸ªå±‚é¢ä¸Šæ¥è¯´ï¼Œå•ç‹¬å®šä¹‰ç®—æ³•ç±»ï¼Œä¹Ÿæ–¹ä¾¿äº†å•å…ƒæµ‹è¯•ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡è‡ªå·±çš„ç®—æ³•è¿›è¡Œå•ç‹¬æµ‹è¯•ã€‚

å®è·µä¸­ï¼Œä¸ä»…å¯ä»¥å°è£…ç®—æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å°è£…å‡ ä¹ä»»ä½•ç±»å‹çš„è§„åˆ™ï¼Œæ˜¯è¦åœ¨åˆ†æè¿‡ç¨‹ä¸­éœ€è¦åœ¨ä¸åŒæ—¶é—´åº”ç”¨ä¸åŒçš„ä¸šåŠ¡è§„åˆ™ï¼Œå°±å¯ä»¥è€ƒè™‘æ˜¯è¦ç­–ç•¥æ¨¡å¼æ¥å¤„ç†å„ç§å˜åŒ–ã€‚

-EFO-

---

ç¬”è€…ä¸“é—¨åœ¨ github ä¸Šåˆ›å»ºäº†ä¸€ä¸ªä»“åº“ï¼Œç”¨äºè®°å½•å¹³æ—¶å­¦ä¹ å…¨æ ˆå¼€å‘ä¸­çš„æŠ€å·§ã€éš¾ç‚¹ã€æ˜“é”™ç‚¹ï¼Œæ¬¢è¿å¤§å®¶ç‚¹å‡»ä¸‹æ–¹é“¾æ¥æµè§ˆã€‚å¦‚æœè§‰å¾—è¿˜ä¸é”™ï¼Œå°±è¯·ç»™ä¸ªå°æ˜Ÿæ˜Ÿå§ï¼ğŸ‘

---

2019/04/24

[AJie](https://github.com/KevinSalvatore/FullStackPoints.git)
